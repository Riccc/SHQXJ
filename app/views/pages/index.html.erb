<style>
    body {
        margin: 0;
        padding: 0;
        height: 100vh;
        background-image: url('<%= asset_path('background_new_6.jpeg') %>');
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
    }

    #modal-content{
        background-image: url('<%= asset_path('background_share.jpeg') %>');
        background-size: cover; /* å›¾ç‰‡æŒ‰æ¯”ä¾‹ç¼©æ”¾ï¼Œè¦†ç›–æ•´ä¸ªæ¨¡æ€æ¡† */
        background-position: center; /* å›¾ç‰‡å±…ä¸­æ˜¾ç¤º */
        background-repeat: no-repeat; /* é˜²æ­¢å›¾ç‰‡é‡å¤ */
    }
    /* é¡µé¢å†…å®¹å®¹å™¨ */
    .container {
        padding: 20px;
    }

    /* æ¨¡æ€æ¡†èƒŒæ™¯é®ç½© */
    .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
        z-index: 1000; /* ç¡®ä¿æ¨¡æ€æ¡†åœ¨æœ€é¡¶å±‚ */
    }

    /* æ¨¡æ€æ¡†å†…å®¹ */
    .modal-content {
        background-color: white;
        padding: 2rem;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        width: 100%;
        max-width: 400px;
        text-align: center;
        position: relative; /* ç¡®ä¿å…³é—­æŒ‰é’®å®šä½æ­£ç¡® */
    }

    /* æ¨¡æ€æ¡†æ ‡é¢˜ */
    .modal-content h2 {
        margin-bottom: 1.5rem;
        font-size: 24px;
        color: #333;
    }

    /* è¾“å…¥æ¡†æ ·å¼ */
    .modal-content input {
        width: 70%;
        padding: 10px;
        margin-bottom: 1rem;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 16px;
    }

    /* ç™»å½•æŒ‰é’®æ ·å¼ */
    .modal-content button {
        width: 100%;
        padding: 10px;
        background-color: #6a11cb;
        color: white;
        border: none;
        border-radius: 5px;
        font-size: 16px;
        cursor: pointer;
    }

    .modal-content button:hover {
        background-color: #2575fc;
    }

    /* å…³é—­æŒ‰é’®æ ·å¼ */
    .close-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        font-size: 24px;
        cursor: pointer;
        color: #666;
    }

    .close-btn:hover {
        color: #333;
    }

    /* ç™»å½•æˆåŠŸæç¤º */
    .success-message {
        color: #28a745;
        font-size: 18px;
        margin-top: 1rem;
    }

    /* ç™»å½•å¤±è´¥æç¤º */
    .error-message {
        color: #dc3545;
        font-size: 18px;
        margin-top: 1rem;
    }

    /* ç»¿è‰²å‹¾å›¾æ ‡ */
    .checkmark {
        font-size: 48px;
        color: #28a745;
        margin-top: 1rem;
    }
    /* å¤´åƒæ·¡å…¥åŠ¨ç”» */
    .fade-in {
        animation: fadeIn 0.4s ease-in-out;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: scale(0.95); }
        to { opacity: 1; transform: scale(1); }
    }

    /* ä¸Šä¼ ä¸­çŠ¶æ€æ ·å¼ */
    .uploading {
        opacity: 0.6;
        pointer-events: none;
    }

    /* åˆ é™¤æŒ‰é’® hover æ•ˆæœ */
    #delete-avatar:hover {
        background-color: darkred;
    }
</style>

<!-- ç™»å½•æ¨¡æ€æ¡† -->
<div class="modal-overlay" id="loginModal">
  <div class="modal-content">
    <span class="close-btn" id="closeBtn">&times;</span>
    <h2>æ¬¢è¿ç™»å½•</h2>
    <form id="loginForm">
      <input type="text" id="username" placeholder="ç”¨æˆ·å" required>
      <input type="password" id="password" placeholder="å¯†ç " required>
      <button type="submit">ç™»å½•</button>
    </form>
    <!-- ç™»å½•æˆåŠŸæˆ–å¤±è´¥æç¤º -->
    <div id="loginMessage"></div>
  </div>
</div>

<div style="display: flex; align-items: center; justify-content: flex-start; height: 3vh; padding-top: 30px; padding-left: 10px;">
  <!-- å·¦ä¾§ Logo -->
  <div>
    <%= image_tag 'top_left_logo.png', style: 'height: 50px; margin-right: 20px;' %>
  </div>

  <!-- å³ä¾§æ–‡å­— -->
  <div style="flex-grow: 1; text-align: center;">
    <h1 style="margin: 0; font-size: 36px; color: #062e24;padding-right: 60px;">å¤©æ°”é¢„æŠ¥äº’åŠ¨ä½“éªŒå¹³å°</h1>
  </div>
</div>

<div style="background-color: transparent; border-radius: 15px; padding: 20px; margin: 20px;margin-bottom: 0px;padding-bottom: 0px">

  <!-- å›¾ç‰‡å’Œæ—¥æœŸé€‰æ‹©æ§ä»¶ -->
  <div style="display: flex; align-items: center; justify-content: space-between;">
    <!-- å·¦ä¾§å›¾ç‰‡ -->
    <div>
      <%= image_tag 'BTQ.png', style: 'height: 30px;' %>
    </div>

    <!-- å³ä¾§æ—¥æœŸé€‰æ‹©æ§ä»¶ -->
    <div style="background-color: #f0f0f0; border-radius: 30px; padding: 10px; border: 2px solid #ffffcc;">
      <input type="date" id="date" name="date" style="border: none; background: transparent; font-size: 16px; color: #333;" value="2025-03-20">
    </div>
  </div>


  <div style="background-color: #f3ececab; border-radius: 15px; padding: 20px; margin: 20px; position: relative;">
    <!-- å‘å·¦ç®­å¤´ -->
    <button id="scroll-left" style="position: absolute; left: 0; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer;">
      <%= image_tag 'go-left.png', style: 'width: 14px; height: 24px;' %>
    </button>

    <!-- å¡ç‰‡åŒºåŸŸ -->
    <div id="card-container" style="display: flex; gap: 10px; overflow-x: hidden; margin: 0 40px;">
      <% (1..13).each do |i| %>
        <div class="card" style="flex: 0 0 100px; height: 120px; background-color: transparent; border-radius: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer;">
          <%= image_tag "icon#{i}.png", style: 'width: 50px; height: 50px;' %>
          <div style="margin-top: 10px; font-size: 14px; text-align: center;">
            <%= @weather_texts[i - 1] %>
          </div>
        </div>
      <% end %>
    </div>

    <!-- å‘å³ç®­å¤´ -->
    <button id="scroll-right" style="position: absolute; right: 0; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer;">
      <%= image_tag 'go-right.png', style: 'width: 14px; height: 24px;' %>
    </button>
  </div>

  <div style="background-color: #f3ececab; border-radius: 15px; padding: 20px; margin: 20px;">
    <!-- ä¸‰ä¸ªæ°´å¹³å¯¹é½çš„ div -->
    <div style="display: flex; gap: 20px;">
      <!-- ç¬¬ä¸€ä¸ª divï¼šé£åŠ›é£å‘ -->
      <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
        <label style="font-size: 16px; color: black;">é£åŠ›é£å‘</label>
        <select style="padding: 5px; border-radius: 5px; border: 1px solid #ccc; font-size: 15px; background-color: #f3ececab;max-width:60%;">
          <% (0..17).each do |i| %>
            <option value="<%= i %>"><%= i %> çº§</option>
          <% end %>
        </select>
        <select style="padding: 5px; border-radius: 5px; border: 1px solid #ccc;font-size: 15px;background-color: #f3ececab;max-width:60%;">
          <option value="north">åŒ—é£</option>
          <option value="northeast">ä¸œåŒ—é£</option>
          <option value="east">ä¸œé£</option>
          <option value="southeast">ä¸œå—é£</option>
          <option value="south">å—é£</option>
          <option value="southwest">è¥¿å—é£</option>
          <option value="west">è¥¿é£</option>
          <option value="northwest">è¥¿åŒ—é£</option>
        </select>
      </div>

      <!-- ç¬¬äºŒä¸ª divï¼šæ¸©åº¦åŒºé—´ -->
      <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
        <!-- æ¸©åº¦é€‰æ‹©ä¸‹æ‹‰æ¡† -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <!-- ä½æ¸©é€‰æ‹© -->
          <div style="flex: 1; margin-right: 10px;">
            <label for="low-temp" style="font-size: 14px; color: black; display: block; margin-bottom: 5px;">
              ä½æ¸©ï¼ˆÂ°Cï¼‰
            </label>
            <select
                id="low-temp"
                style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #ddd; font-size: 14px; outline: none;background-color: #f3ececab;">
              <!-- åŠ¨æ€ç”Ÿæˆä½æ¸©é€‰é¡¹ -->
              <script>
                  for (let i = -20; i <= 50; i++) {
                      document.write(`<option value="${i}">${i}Â°C</option>`);
                  }
              </script>
            </select>
          </div>

          <!-- é«˜æ¸©é€‰æ‹© -->
          <div style="flex: 1; margin-left: 10px;">
            <label for="high-temp" style="font-size: 14px; color: black; display: block; margin-bottom: 5px;">
              é«˜æ¸©ï¼ˆÂ°Cï¼‰
            </label>
            <select
                id="high-temp"
                style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #ddd; font-size: 14px; outline: none;background-color: #f3ececab;">
              <!-- åŠ¨æ€ç”Ÿæˆé«˜æ¸©é€‰é¡¹ -->
              <script>
                  for (let i = -20; i <= 50; i++) {
                      document.write(`<option value="${i}" ${i === 50 ? 'selected' : ''}>${i}Â°C</option>`);
                  }
              </script>
            </select>
          </div>
        </div>

        <!-- å½“å‰æ¸©åº¦åŒºé—´æ˜¾ç¤º -->
        <div id="temperature-range" style="font-size: 14px; color: black; text-align: left; margin-bottom: 20px;">
          å½“å‰æ¸©åº¦åŒºé—´ï¼š-20Â°C åˆ° 50Â°C
        </div>
      </div>

      <!-- ç¬¬ä¸‰ä¸ª divï¼ˆå ä½ï¼‰ -->
      <div style="flex: 1; display: flex; flex-direction: column; gap: 10px;">
        <!-- æ–‡å­—æ ‡ç­¾å’ŒæŒ‰é’®æ°´å¹³å¯¹é½ -->
        <div style="display: flex; align-items: center; gap: 10px;">
          <!-- æ–‡å­—æ ‡ç­¾ -->
          <label style="font-size: 16px; color: black; margin: 0;">æ¸©é¦¨æç¤º</label>

          <!-- æŒ‰é’® -->
          <button
              id="edit-button"
              style="padding: 5px 10px; font-size: 14px; color: #fff; background-color: orange; border: none; border-radius: 5px; cursor: pointer;"
              onclick="toggleEditor()"
          >
            è‡ªå·±å†™
          </button>
        </div>

        <!-- å¯Œæ–‡æœ¬ä¸‹æ‹‰æ¡† -->
        <div id="rich-text-container">
          <!-- ä¸‹æ‹‰æ¡† -->
          <select
              id="rich-text-select"
              style="padding: 5px; border-radius: 5px; border: 1px solid #ccc; width: 100%; height: 35px; font-size: 14px;background-color: #f3ececab;"
          >
            <option value="è¯·é€‰æ‹©é¢„è®¾å¥å­">è¯·é€‰æ‹©é¢„è®¾å¥å­</option>
            <option value="ä»Šå¤©å¤©æ°”å¾ˆå¥½ï¼Œé€‚åˆå¤–å‡ºã€‚">ä»Šå¤©å¤©æ°”å¾ˆå¥½ï¼Œé€‚åˆå¤–å‡ºã€‚</option>
            <option value="è¯·æ³¨æ„é˜²å¯’ä¿æš–ã€‚">è¯·æ³¨æ„é˜²å¯’ä¿æš–ã€‚</option>
            <option value="å¤©æ°”ç‚çƒ­ï¼Œæ³¨æ„é˜²æ™’ã€‚">å¤©æ°”ç‚çƒ­ï¼Œæ³¨æ„é˜²æ™’ã€‚</option>
          </select>

          <!-- å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ -->
          <textarea
              id="rich-text-area"
              style="background-color: #f3ececab;display: none; width: 100%; height: 100px; padding: 5px; border-radius: 5px; border: 1px solid #ccc; font-size: 14px;"
              placeholder="åœ¨è¿™é‡Œè¾“å…¥è‡ªå®šä¹‰å†…å®¹..."
          ></textarea>
        </div>
      </div>
    </div>
  </div>

  <div style="background-color: #f3ececab; border-radius: 15px; padding: 20px; margin: 20px;">
    <!-- å¤–å±‚ Flex å®¹å™¨ -->
    <div style="display: flex; align-items: center; gap: 10px;"> <!-- å‡å°‘ gap ä¸º 10px -->
      <!-- å·¦ä¾§ divï¼šæ¸©åº¦ã€å¤©æ°”ã€æ–‡æœ¬å†…å®¹ -->
      <div style="flex: 1; display: flex; flex-direction: column; gap: 10px; justify-content: center;max-width: 400px;text-align: center;">
        <!-- æ˜¾ç¤ºæ¸©åº¦ -->
        <div style="font-size: 24px; color: black;">
          <span id="min-temp-display">-20</span>Â° ~ <span id="max-temp-display">50</span>Â°
        </div>
        <!-- æ˜¾ç¤ºå¤©æ°” -->
        <div id="chosen_text" style="font-size: 18px; color: black;">
          æ™´å¤©
        </div>
        <!-- æ˜¾ç¤ºä¸‹æ‹‰æ¡†é€‰æ‹©çš„æ–‡æœ¬å†…å®¹ -->
        <div id="selected-text" style="font-size: 16px; color: black;">
          <span id="selected-text-content">è¯·é€‰æ‹©é¢„è®¾å¥å­</span>
        </div>
      </div>

      <!-- å›¾ç‰‡ -->
      <div style="flex: 0 0 auto; margin-left: 10px;min-width: 400px;"> <!-- å¢åŠ  margin-left ä¸º 10px -->
        <%= image_tag 'sun.png', style: 'height: 50px;' ,id: "chosen_img"%>
      </div>

      <!-- å³ä¾§ divï¼šç”Ÿæˆé¢„æŠ¥æŒ‰é’® -->
      <div style="flex: 0 0 auto;">
        <button id="generate-forecast-button" style="padding: 10px 20px; font-size: 16px; color: #fff; background-color: orange; border: none; border-radius: 5px; cursor: pointer;">
          ç”Ÿæˆé¢„æŠ¥
        </button>
      </div>
    </div>
  </div>

</div>



<!-- æ¨¡æ€æ¡† -->
<div id="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); justify-content: center; align-items: center;">
  <div id="modal-content" style="background-color: white; padding: 30px; border-radius: 12px; width: 300px; max-height: 90vh; overflow-y: auto; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);">
    <!-- æ¨¡æ€æ¡†æ ‡é¢˜ -->
    <div style="font-size: 20px; color: #333; font-weight: bold; margin-bottom: 24px; text-align: center;">
      å¡«å†™æˆ‘çš„é¢„æŠ¥å‘˜ä¿¡æ¯
    </div>

    <!-- å¤´åƒä¸Šä¼ åŒºåŸŸ -->
    <div style="display: flex; justify-content: center; margin-bottom: 24px; position: relative;">
      <img id="avatar-preview" src="" alt="å¤´åƒé¢„è§ˆ" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; display: none; cursor: pointer;"/>

      <!-- åˆ é™¤æŒ‰é’® -->
      <div id="delete-avatar" title="åˆ é™¤å¤´åƒ" style="position: absolute; top: -5px; right: calc(50% - 45px); background-color: red; color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 14px; text-align: center; line-height: 20px; cursor: pointer; display: none;">
        Ã—
      </div>

      <!-- ç›¸æœºæŒ‰é’® -->
      <button id="camera-button" style="width: 100px; height: 100px; border-radius: 50%; background-color: #f0f0f0; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 24px;">
        ğŸ“·
      </button>
    </div>

    <!-- èƒŒæ™¯å›¾ä¸Šä¼ åŒºåŸŸ -->
    <div style="margin-bottom: 24px;">
      <div style="display: flex; justify-content: center;">
        <button id="background-upload-button" style="padding: 10px 16px; font-size: 14px; background-color: #e0e0e0; border: none; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 8px;">
          <span id="background-upload-text">ä¸Šä¼ èƒŒæ™¯å›¾</span>
          <span id="background-upload-check" style="display: none; font-size: 16px;">âœ…</span>
        </button>
      </div>
    </div>




    <!-- æˆ‘çš„åå­— -->
    <div style="font-size: 18px; color: black; margin-bottom: 8px;text-align: center;">
      æˆ‘çš„åå­—
    </div>
    <input type="text" id="name-input" style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #ddd; margin-bottom: 20px; font-size: 14px; outline: none; transition: border-color 0.3s ease;">

    <!-- æˆ‘çš„ç”Ÿæ—¥ -->
    <div style="font-size: 18px; color: black; margin-bottom: 8px;text-align: center;">
      æˆ‘çš„ç”Ÿæ—¥
    </div>
    <input type="date" id="birthday-input" style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #ddd; margin-bottom: 24px; font-size: 14px; outline: none; transition: border-color 0.3s ease;">

    <!-- åˆ†äº«æŒ‰é’® -->
    <div style="display: flex; justify-content: center;">
      <button id="share-button" style="padding: 12px 24px; font-size: 16px; color: #fff; background-color: orange   ; border: none; border-radius: 6px; cursor: pointer; transition: background-color 0.3s ease;">
        åˆ†äº«
      </button>
    </div>
  </div>
</div>

<!-- ç™»å½•æ¨¡æ€æ¡† -->

<style>
    .card:hover {
        background-color: orange;
    }
    .card.selected {
        background-color: orange !important;
    }
</style>
<script>

    document.addEventListener("DOMContentLoaded", function() {
        const cardContainer = document.getElementById("card-container");
        const scrollLeftButton = document.getElementById("scroll-left");
        const scrollRightButton = document.getElementById("scroll-right");
        const cards = document.querySelectorAll(".card");
        const lowTempSelect = document.getElementById('low-temp');
        const highTempSelect = document.getElementById('high-temp');
        const temperatureRange = document.getElementById('temperature-range');
        const chosenImage = document.querySelector('#chosen_img'); // é€‰ä¸­çš„å¡ç‰‡å›¾ç‰‡
        const chosenText = document.querySelector('#chosen_text'); // é€‰ä¸­çš„å¡ç‰‡æ–‡å­—
        const loginmodal = document.getElementById('loginModal');
        loginmodal.style.display = 'flex';

        const firstCard = cards[0];
        firstCard.classList.add('selected');
        localStorage.clear();

        // è·å–ç¬¬ä¸€å¼ å¡ç‰‡çš„å›¾ç‰‡è·¯å¾„å’Œæ–‡å­—å†…å®¹
        const firstImageSrc = firstCard.querySelector('img').src;
        const firstText = firstCard.querySelector('div').textContent;

        // æ›´æ–°é€‰ä¸­çš„å¡ç‰‡å›¾ç‰‡
        chosenImage.src = firstImageSrc;

        // æ›´æ–°é€‰ä¸­çš„å¡ç‰‡æ–‡å­—
        chosenText.textContent = firstText;

        // æ›´æ–°æ¸©åº¦åŒºé—´æ˜¾ç¤º
        function updateTemperatureRange() {
            const lowTemp = lowTempSelect.value;
            const highTemp = highTempSelect.value;
            const minTemp = document.getElementById("min-temp-display");
            const maxTemp = document.getElementById("max-temp-display");

            minTemp.textContent = lowTemp;
            maxTemp.textContent = highTemp;

            if (parseInt(lowTemp) > parseInt(highTemp)) {
                temperatureRange.textContent = 'ä½æ¸©ä¸èƒ½é«˜äºé«˜æ¸©ï¼';
                temperatureRange.style.color = '#ff4d4d'; // é”™è¯¯æç¤ºé¢œè‰²
            } else {
                temperatureRange.textContent = `å½“å‰æ¸©åº¦åŒºé—´ï¼š${lowTemp}Â°C åˆ° ${highTemp}Â°C`;
                temperatureRange.style.color = 'black'; // æ­£å¸¸é¢œè‰²
            }
        }

        // ç›‘å¬ä½æ¸©é€‰æ‹©å˜åŒ–
        lowTempSelect.addEventListener('change', updateTemperatureRange);

        // ç›‘å¬é«˜æ¸©é€‰æ‹©å˜åŒ–
        highTempSelect.addEventListener('change', updateTemperatureRange);

        //é»˜è®¤é€‰ä¸­ç¬¬ä¸€å¼ å¡ç‰‡
        cards[0].classList.add("selected");

        // å‘å·¦æ»šåŠ¨
        scrollLeftButton.addEventListener("click", function() {
            cardContainer.scrollBy({ left: -200, behavior: "smooth" });
        });

        // å‘å³æ»šåŠ¨
        scrollRightButton.addEventListener("click", function() {
            cardContainer.scrollBy({ left: 200, behavior: "smooth" });
        });

        // ç‚¹å‡»å¡ç‰‡æ›´æ¢èƒŒæ™¯é¢œè‰²ï¼Œå¹¶æ›´æ–°é€‰ä¸­çš„å¡ç‰‡å›¾ç‰‡å’Œæ–‡å­—
        cards.forEach(card => {
            card.addEventListener('click', function () {
                // ç§»é™¤æ‰€æœ‰å¡ç‰‡çš„é€‰ä¸­çŠ¶æ€
                cards.forEach(c => c.classList.remove('selected'));

                // ä¸ºå½“å‰å¡ç‰‡æ·»åŠ é€‰ä¸­çŠ¶æ€
                card.classList.add('selected');

                // è·å–å½“å‰å¡ç‰‡çš„å›¾ç‰‡è·¯å¾„
                const selectedImageSrc = card.querySelector('img').src;

                // è·å–å½“å‰å¡ç‰‡çš„æ–‡å­—å†…å®¹
                const selectedText = card.querySelector('div').textContent;

                // æ›´æ–°é€‰ä¸­çš„å¡ç‰‡å›¾ç‰‡
                chosenImage.src = selectedImageSrc;

                // æ›´æ–°é€‰ä¸­çš„å¡ç‰‡æ–‡å­—
                chosenText.textContent = selectedText;
            });
        });

        const generateButton = document.getElementById("generate-forecast-button"); // è·å–â€œç”Ÿæˆé¢„æŠ¥â€æŒ‰é’®
        const modal = document.getElementById("modal"); // è·å–æ¨¡æ€æ¡†
        const shareButton = document.getElementById("share-button"); // è·å–åˆ†äº«æŒ‰é’®
        const cameraButton = document.getElementById("camera-button");
        const avatarPreview = document.getElementById("avatar-preview");
        const deleteAvatar = document.getElementById("delete-avatar");

        // ç‚¹å‡»â€œç”Ÿæˆé¢„æŠ¥â€æŒ‰é’®ï¼Œæ˜¾ç¤ºæ¨¡æ€æ¡†
        generateButton.addEventListener("click", function() {
            modal.style.display = "flex";
        });

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨ï¼Œå…³é—­æ¨¡æ€æ¡†
        modal.addEventListener("click", function(event) {
            if (event.target === modal) {
                modal.style.display = "none";
            }
        });
        //å¤´åƒä¸Šä¼ 
        // function triggerUpload() {
        //     const fileInput = document.createElement("input");
        //     fileInput.type = "file";
        //     fileInput.accept = "image/*";
        //
        //     fileInput.onchange = function (event) {
        //         const file = event.target.files[0];
        //         if (file) {
        //             // ä¸Šä¼ ä¸­çŠ¶æ€ï¼šæŒ‰é’®å˜ç°å¹¶ç¦ç”¨
        //             cameraButton.textContent = "ä¸Šä¼ ä¸­â€¦";
        //             cameraButton.classList.add("uploading");
        //
        //             const reader = new FileReader();
        //             reader.onload = function (e) {
        //                 const imageData = e.target.result;
        //
        //                 // å±•ç¤ºå¤´åƒ
        //                 avatarPreview.src = imageData;
        //                 avatarPreview.style.display = "block";
        //                 avatarPreview.classList.add("fade-in");
        //
        //                 // æ˜¾ç¤ºåˆ é™¤æŒ‰é’® & éšè—ç›¸æœºæŒ‰é’®
        //                 deleteAvatar.style.display = "block";
        //                 cameraButton.style.display = "none";
        //
        //                 // å­˜å…¥ç¼“å­˜
        //                 localStorage.setItem("uploadedImage", imageData);
        //
        //                 // æ¢å¤æŒ‰é’®çŠ¶æ€
        //                 cameraButton.textContent = "ğŸ“·";
        //                 cameraButton.classList.remove("uploading");
        //             };
        //             reader.readAsDataURL(file);
        //         }
        //     };
        //
        //     fileInput.click();
        // }
        async function triggerUpload() {
            // åˆ›å»ºé€‰æ‹©èœå•
            const modal = document.createElement('div');
            modal.style.position = 'fixed';
            modal.style.top = '0';
            modal.style.left = '0';
            modal.style.width = '100%';
            modal.style.height = '100%';
            modal.style.backgroundColor = 'rgba(0,0,0,0.5)';
            modal.style.display = 'flex';
            modal.style.flexDirection = 'column';
            modal.style.justifyContent = 'center';
            modal.style.alignItems = 'center';
            modal.style.zIndex = '1000';

            // åˆ›å»ºé€‰é¡¹æŒ‰é’®
            const fileOption = createOptionButton('ä»ç›¸å†Œé€‰æ‹©', '#4CAF50');
            const cameraOption = createOptionButton('æ‹ç…§ä¸Šä¼ ', '#2196F3');
            const cancelOption = createOptionButton('å–æ¶ˆ', '#f44336');

            modal.appendChild(fileOption);
            modal.appendChild(cameraOption);
            modal.appendChild(cancelOption);
            document.body.appendChild(modal);

            // å¤„ç†é€‰æ‹©
            return new Promise((resolve) => {
                // ä»ç›¸å†Œé€‰æ‹©
                fileOption.onclick = () => {
                    document.body.removeChild(modal);
                    const fileInput = document.createElement("input");
                    fileInput.type = "file";
                    fileInput.accept = "image/*";

                    fileInput.onchange = function (event) {
                        handleImageUpload(event.target.files[0]);
                        resolve();
                    };
                    fileInput.click();
                };

                // æ‹ç…§ä¸Šä¼ 
                cameraOption.onclick = async () => {
                    document.body.removeChild(modal);
                    try {
                        // 1. é¦–å…ˆæ£€æŸ¥æ˜¯å¦æ”¯æŒåª’ä½“è®¾å¤‡
                        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                            throw new Error('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæ‘„åƒå¤´è®¿é—®');
                        }

                        // 2. è¯·æ±‚æ‘„åƒå¤´æƒé™
                        const stream = await navigator.mediaDevices.getUserMedia({
                            video: {
                                facingMode: 'user', // å‰ç½®æ‘„åƒå¤´
                                width: { ideal: 1280 },
                                height: { ideal: 720 }
                            }
                        }).catch(err => {
                            // 3. å¤„ç†æƒé™æ‹’ç»æƒ…å†µ
                            if (err.name === 'NotAllowedError') {
                                showPermissionAlert('è¯·å…è®¸è®¿é—®æ‘„åƒå¤´æƒé™');
                            } else if (err.name === 'NotFoundError') {
                                showPermissionAlert('æœªæ‰¾åˆ°å¯ç”¨çš„æ‘„åƒå¤´');
                            }
                            throw err;
                        });

                        // åˆ›å»ºæ‹ç…§ç•Œé¢
                        const cameraView = document.createElement('div');
                        cameraView.style.position = 'fixed';
                        cameraView.style.top = '0';
                        cameraView.style.left = '0';
                        cameraView.style.width = '100%';
                        cameraView.style.height = '100%';
                        cameraView.style.backgroundColor = 'rgba(0,0,0,0.9)';
                        cameraView.style.zIndex = '1000';

                        const video = document.createElement('video');
                        video.style.width = '100%';
                        video.style.maxHeight = '80vh';
                        video.style.objectFit = 'cover';
                        video.autoplay = true;
                        video.srcObject = stream;

                        const buttonContainer = document.createElement('div');
                        buttonContainer.style.position = 'fixed';
                        buttonContainer.style.bottom = '20px';
                        buttonContainer.style.left = '0';
                        buttonContainer.style.width = '100%';
                        buttonContainer.style.display = 'flex';
                        buttonContainer.style.justifyContent = 'center';
                        buttonContainer.style.gap = '20px';

                        const captureBtn = document.createElement('button');
                        captureBtn.innerHTML = 'æ‹ç…§';
                        captureBtn.style.padding = '15px 30px';
                        captureBtn.style.backgroundColor = '#4CAF50';
                        captureBtn.style.color = 'white';
                        captureBtn.style.border = 'none';
                        captureBtn.style.borderRadius = '50px';
                        captureBtn.style.fontSize = '16px';
                        captureBtn.style.cursor = 'pointer';

                        const cancelBtn = document.createElement('button');
                        cancelBtn.innerHTML = 'å–æ¶ˆ';
                        cancelBtn.style.padding = '15px 30px';
                        cancelBtn.style.backgroundColor = '#f44336';
                        cancelBtn.style.color = 'white';
                        cancelBtn.style.border = 'none';
                        cancelBtn.style.borderRadius = '50px';
                        cancelBtn.style.fontSize = '16px';
                        cancelBtn.style.cursor = 'pointer';

                        buttonContainer.appendChild(captureBtn);
                        buttonContainer.appendChild(cancelBtn);
                        cameraView.appendChild(video);
                        cameraView.appendChild(buttonContainer);
                        document.body.appendChild(cameraView);

                        // æ‹ç…§å¤„ç†
                        captureBtn.onclick = () => {
                            const canvas = document.createElement('canvas');
                            canvas.width = video.videoWidth;
                            canvas.height = video.videoHeight;
                            const ctx = canvas.getContext('2d');

                            // é•œåƒåè½¬ï¼ˆå‰ç½®æ‘„åƒå¤´ï¼‰
                            ctx.translate(canvas.width, 0);
                            ctx.scale(-1, 1);
                            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

                            canvas.toBlob((blob) => {
                                handleImageUpload(new File([blob], 'avatar.jpg', { type: 'image/jpeg' }));
                                stream.getTracks().forEach(track => track.stop());
                                document.body.removeChild(cameraView);
                                resolve();
                            }, 'image/jpeg', 0.9);
                        };

                        // å–æ¶ˆæ‹ç…§
                        cancelBtn.onclick = () => {
                            stream.getTracks().forEach(track => track.stop());
                            document.body.removeChild(cameraView);
                            resolve();
                        };
                    } catch (error) {
                        console.error('æ‘„åƒå¤´é”™è¯¯:', error);
                        // å›é€€åˆ°æ–‡ä»¶é€‰æ‹©
                        const fileInput = document.createElement("input");
                        fileInput.type = "file";
                        fileInput.accept = "image/*";
                        fileInput.onchange = function (event) {
                            handleImageUpload(event.target.files[0]);
                            resolve();
                        };
                        fileInput.click();
                    }
                };

                // å–æ¶ˆé€‰æ‹©
                cancelOption.onclick = () => {
                    document.body.removeChild(modal);
                    resolve();
                };
            });

            function createOptionButton(text, bgColor) {
                const btn = document.createElement('button');
                btn.textContent = text;
                btn.style.padding = '12px 24px';
                btn.style.margin = '8px';
                btn.style.border = 'none';
                btn.style.borderRadius = '8px';
                btn.style.backgroundColor = bgColor;
                btn.style.color = 'white';
                btn.style.fontSize = '16px';
                btn.style.cursor = 'pointer';
                btn.style.width = '200px';
                btn.style.transition = 'all 0.3s';

                btn.onmouseenter = () => {
                    btn.style.opacity = '0.9';
                    btn.style.transform = 'translateY(-2px)';
                };
                btn.onmouseleave = () => {
                    btn.style.opacity = '1';
                    btn.style.transform = 'none';
                };

                return btn;
            }

            function showPermissionAlert(message) {
                alert(`${message}\n\nè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š\n1. ç‚¹å‡»åœ°å€æ å·¦ä¾§çš„é”å½¢å›¾æ ‡\n2. é€‰æ‹©"ç½‘ç«™è®¾ç½®"\n3. æ‰¾åˆ°"æ‘„åƒå¤´"é€‰é¡¹\n4. æ”¹ä¸º"å…è®¸"`);
            }
        }

        function handleImageUpload(file) {
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                const imageData = e.target.result;

                // å­˜å…¥ç¼“å­˜
                localStorage.setItem("uploadedImage", imageData);

                // æ›´æ–°å¤´åƒæ˜¾ç¤º
                const shareAvatar = document.getElementById("share-avatar");
                if (shareAvatar) {
                    shareAvatar.src = imageData;
                    shareAvatar.style.display = "block";
                }
            };
            reader.readAsDataURL(file);
        }

// ä¿æŒåŸæœ‰çš„ handleImageUpload å‡½æ•°ä¸å˜

// æå–å‡ºæ¥çš„é€šç”¨å›¾ç‰‡å¤„ç†å‡½æ•°
        function handleImageUpload(file) {
            if (!file) return;

            // ä¸Šä¼ ä¸­çŠ¶æ€ï¼šæŒ‰é’®å˜ç°å¹¶ç¦ç”¨
            cameraButton.textContent = "ä¸Šä¼ ä¸­â€¦";
            cameraButton.classList.add("uploading");

            const reader = new FileReader();
            reader.onload = function (e) {
                const imageData = e.target.result;

                // å±•ç¤ºå¤´åƒ
                avatarPreview.src = imageData;
                avatarPreview.style.display = "block";
                avatarPreview.classList.add("fade-in");

                // æ˜¾ç¤ºåˆ é™¤æŒ‰é’® & éšè—ç›¸æœºæŒ‰é’®
                deleteAvatar.style.display = "block";
                cameraButton.style.display = "none";

                // å­˜å…¥ç¼“å­˜
                localStorage.setItem("uploadedImage", imageData);

                // æ¢å¤æŒ‰é’®çŠ¶æ€
                cameraButton.textContent = "ğŸ“·";
                cameraButton.classList.remove("uploading");
            };
            reader.readAsDataURL(file);
        }

        const backgroundUploadButton = document.getElementById("background-upload-button");
        const backgroundUploadText = document.getElementById("background-upload-text");
        const backgroundUploadCheck = document.getElementById("background-upload-check");

        backgroundUploadButton.addEventListener("click", function () {
            const fileInput = document.createElement("input");
            fileInput.type = "file";
            fileInput.accept = "image/*";

            fileInput.onchange = function (event) {
                const file = event.target.files[0];
                if (file) {
                    backgroundUploadText.textContent = "ä¸Šä¼ ä¸­â€¦";
                    backgroundUploadButton.style.opacity = "0.6";
                    backgroundUploadButton.style.pointerEvents = "none";

                    const reader = new FileReader();
                    reader.onload = function (e) {
                        const backgroundImageData = e.target.result;

                        localStorage.setItem("uploadedBackgroundImage", backgroundImageData);

                        // è®¾ç½®æŒ‰é’®ä¸ºä¸Šä¼ å®ŒæˆçŠ¶æ€
                        backgroundUploadText.textContent = "å·²ä¸Šä¼ ";
                        backgroundUploadCheck.style.display = "inline";
                        backgroundUploadButton.style.backgroundColor = "#4CAF50"; // æˆåŠŸç»¿è‰²
                        backgroundUploadButton.style.color = "#fff";
                        backgroundUploadButton.style.opacity = "1";
                        backgroundUploadButton.style.pointerEvents = "auto";
                    };
                    reader.readAsDataURL(file);
                }
            };

            fileInput.click();
        });



// äº‹ä»¶ç»‘å®š
        cameraButton.addEventListener("click", triggerUpload);
        avatarPreview.addEventListener("click", triggerUpload);

        deleteAvatar.addEventListener("click", function () {
            avatarPreview.src = "";
            avatarPreview.style.display = "none";
            cameraButton.style.display = "flex";
            deleteAvatar.style.display = "none";
            localStorage.removeItem("uploadedImage");
        });

// åˆå§‹åŒ–æ¨¡æ€æ¡†æ—¶è½½å…¥å¤´åƒ
        function showModal() {
            const modal = document.getElementById("modal");
            modal.style.display = "flex";

            const savedImage = localStorage.getItem("uploadedImage");
            if (savedImage) {
                avatarPreview.src = savedImage;
                avatarPreview.style.display = "block";
                avatarPreview.classList.add("fade-in");
                deleteAvatar.style.display = "block";
                cameraButton.style.display = "none";
            } else {
                avatarPreview.style.display = "none";
                deleteAvatar.style.display = "none";
                cameraButton.style.display = "flex";
            }
        }

        // ç‚¹å‡»åˆ†äº«æŒ‰é’®ï¼Œè·³è½¬åˆ°åˆ†äº«é¡µé¢
        shareButton.addEventListener("click", function() {
            const name = document.getElementById("name-input").value;
            const birthday = document.getElementById("birthday-input").value;
            const chosen_date = document.getElementById("date").value;
            const low_temp = document.getElementById("low-temp").value;
            const high_temp = document.getElementById("high-temp").value;
            const selected_text_content = document.getElementById("selected-text-content").textContent;
            const chosen_img = document.getElementById("chosen_img").src;
            const chosen_text = document.getElementById("chosen_text").textContent;

            // è·³è½¬åˆ°åˆ†äº«é¡µé¢ï¼Œå¹¶ä¼ é€’å‚æ•°
            window.location.href = "<%= share_path %>?name=" + encodeURIComponent(name) + "&birthday=" + encodeURIComponent(birthday)+ "&chosen_date=" + encodeURIComponent(chosen_date)+ "&low_temp=" + encodeURIComponent(low_temp)+ "&high_temp=" + encodeURIComponent(high_temp)+ "&selected_text_content=" + encodeURIComponent(selected_text_content)+ "&chosen_img=" + encodeURIComponent(chosen_img)+ "&chosen_text=" + encodeURIComponent(chosen_text);
        });
    });
    // å…³é—­æ¨¡æ€æ¡†
    document.getElementById('closeBtn').addEventListener('click', function () {
        const loginModal = document.getElementById('loginModal');
        loginModal.style.display = 'none';
    });

    // å¤„ç†ç™»å½•è¡¨å•æäº¤
    document.getElementById('loginForm').addEventListener('submit', function (event) {
        event.preventDefault();
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        const loginMessage = document.getElementById('loginMessage');

        // æ¸…ç©ºä¹‹å‰çš„æç¤º
        loginMessage.innerHTML = '';

        // ç®€å•éªŒè¯ï¼ˆå®é™…é¡¹ç›®ä¸­éœ€ç»“åˆåç«¯éªŒè¯ï¼‰
        if (username === 'admin' && password === '1') {
            // ç™»å½•æˆåŠŸ
            loginMessage.innerHTML = `
          <div class="checkmark">&#10004;</div>
          <div class="success-message">ç™»å½•æˆåŠŸï¼</div>
        `;
            // 1.5 ç§’åå…³é—­æ¨¡æ€æ¡†
            setTimeout(() => {
                const loginModal = document.getElementById('loginModal');
                loginModal.style.display = 'none';
            }, 1000);
        } else {
            // ç™»å½•å¤±è´¥
            loginMessage.innerHTML = `<div class="error-message">ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç”¨æˆ·åæˆ–å¯†ç ï¼</div>`;
        }
    });

    // è·å–ç›¸å…³å…ƒç´ 
    const selectElement = document.getElementById('rich-text-select');
    const textareaElement = document.getElementById('rich-text-area');
    const editButton = document.getElementById('edit-button');
    const selectedTextContent = document.getElementById('selected-text-content');

    // æ›´æ–° selected-text-content çš„å†…å®¹
    function updateSelectedTextContent() {
        if (textareaElement.style.display === 'none') {
            // å¦‚æœå¯Œæ–‡æœ¬ç¼–è¾‘å™¨éšè—ï¼Œæ˜¾ç¤º select çš„å†…å®¹
            selectedTextContent.textContent = selectElement.value;
        } else {
            // å¦‚æœå¯Œæ–‡æœ¬ç¼–è¾‘å™¨æ˜¾ç¤ºï¼Œæ˜¾ç¤º textarea çš„å†…å®¹
            selectedTextContent.textContent = textareaElement.value.trim() || selectElement.value;
        }
    }

    // ç›‘å¬ select å˜åŒ–
    selectElement.addEventListener('change', function () {
        updateSelectedTextContent();
    });

    // ç›‘å¬ textarea è¾“å…¥
    textareaElement.addEventListener('input', function () {
        updateSelectedTextContent();
    });

    // åˆ‡æ¢ç¼–è¾‘çŠ¶æ€
    function toggleEditor() {
        if (textareaElement.style.display === 'none') {
            // åˆ‡æ¢åˆ°å¯Œæ–‡æœ¬ç¼–è¾‘æ¨¡å¼
            selectElement.style.display = 'none';
            textareaElement.style.display = 'block';
            editButton.textContent = 'å®Œæˆ';
            textareaElement.focus(); // è‡ªåŠ¨èšç„¦åˆ°å¯Œæ–‡æœ¬ç¼–è¾‘å™¨
        } else {
            // åˆ‡æ¢å›é€‰æ‹©æ¡†æ¨¡å¼
            const customText = textareaElement.value.trim();
            if (customText) {
                // å°†å¯Œæ–‡æœ¬å†…å®¹æ·»åŠ åˆ°é€‰æ‹©æ¡†ä¸­
                const newOption = document.createElement('option');
                newOption.value = customText;
                newOption.textContent = customText;
                selectElement.appendChild(newOption);
                selectElement.value = customText; // é€‰ä¸­æ–°æ·»åŠ çš„é€‰é¡¹
            }
            textareaElement.style.display = 'none';
            selectElement.style.display = 'block';
            editButton.textContent = 'è‡ªå·±å†™';
        }
        // æ›´æ–°æ˜¾ç¤ºå†…å®¹
        updateSelectedTextContent();
    }

    // åˆå§‹åŒ–æ˜¾ç¤ºå†…å®¹
    updateSelectedTextContent();
</script>